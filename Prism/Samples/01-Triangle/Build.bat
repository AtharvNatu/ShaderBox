@echo off

set EXPORT_PRISM_LIB=false

cls

if exist *.exe del *.exe

cd Bin

if exist *.obj del *.obj
if exist *.exe del *.exe
if exist *.res del *.res

if %EXPORT_PRISM_LIB% == false (

    echo ----------------------------------------------------------------------------------------------------------------
    echo Compiling Source Code For Executable...
    echo ----------------------------------------------------------------------------------------------------------------
        cl.exe /c /EHsc /std:c++20 /DUNICODE ^
        -I "C:\glew\include" ^
        -I "..\Include\Core" ^
        "..\Source\Core\*.cpp" ^
        "..\Test\*.cpp"

    @echo:
    echo ----------------------------------------------------------------------------------------------------------------
    echo Compiling Resource Files ...
    echo ----------------------------------------------------------------------------------------------------------------
        rc.exe /I "..\Include\Core" "..\Resources\App.rc"
        move "..\Resources\App.res" "..\Bin\"  > nul 2>&1

    @echo:
    echo ----------------------------------------------------------------------------------------------------------------
    echo Linking Libraries and Resources...
    echo Creating Executable...
    echo ----------------------------------------------------------------------------------------------------------------
        link.exe *.obj *.res ^
        /LIBPATH:"C:\glew\lib\Release\x64" ^
        user32.lib gdi32.lib shell32.lib ^
        /SUBSYSTEM:WINDOWS ^
        /OUT:App.exe

    @echo:
    echo ----------------------------------------------------------------------------------------------------------------
    echo Launching Application ...
    echo ----------------------------------------------------------------------------------------------------------------
        move App.exe ..\  > nul 2>&1
        cd ..
        App.exe

) else (
   
    echo ----------------------------------------------------------------------------------------------------------------
    echo Compiling Static Library Source Code ...
    echo ----------------------------------------------------------------------------------------------------------------
        cl.exe /c /EHsc /std:c++20 /DUNICODE ^
        -I "C:\glew\include" ^
        -I "..\Include\Core" ^
        "..\Source\Core\*.cpp"

    @echo:
    echo ----------------------------------------------------------------------------------------------------------------
    echo Creating Static Library ...
    echo ----------------------------------------------------------------------------------------------------------------
        lib.exe /OUT:Prism.lib *.obj

    echo ----------------------------------------------------------------------------------------------------------------
    echo Compiling Application Source Code...
    echo ----------------------------------------------------------------------------------------------------------------
        cl.exe /c /EHsc /std:c++20 /DUNICODE ^
        -I "C:\glew\include" ^
        -I "..\Include\Core" ^
        "..\Test\*.cpp" ^
    
    @echo:
    echo ----------------------------------------------------------------------------------------------------------------
    echo Compiling Resource Files ...
    echo ----------------------------------------------------------------------------------------------------------------
        rc.exe /I "..\Include\Core" "..\Resources\App.rc"
        move "..\Resources\App.res" "..\Bin\"  > nul 2>&1

    @echo:
    echo ----------------------------------------------------------------------------------------------------------------
    echo Linking Libraries and Resources...
    echo Creating Executable...
    echo ----------------------------------------------------------------------------------------------------------------
        link.exe *.obj *.res ^
        /LIBPATH:"C:\glew\lib\Release\x64" ^
        user32.lib gdi32.lib shell32.lib Prism.lib ^
        /SUBSYSTEM:WINDOWS ^
        /OUT:App.exe

    @echo:
    echo ----------------------------------------------------------------------------------------------------------------
    echo Launching Application ...
    echo ----------------------------------------------------------------------------------------------------------------
        move App.exe ..\  > nul 2>&1
        cd ..
        App.exe
)
